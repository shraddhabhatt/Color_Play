<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Color Play</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
  <link rel="stylesheet" href="demo.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tracking.js/1.1.3/tracking-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.2/dat.gui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js"></script>
  <!-- Compiled and minified CSS 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">-->
  <!-- Compiled and minified JavaScript 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>-->
  <!-- google fonts -->
  <link href="https://fonts.googleapis.com/css?family=Bungee|Ubuntu:300,300i" rel="stylesheet">
    
  <script src="color_camera_gui.js"></script>
  <style>
  video, canvas {
    margin-left: 100px;
    margin-top: 35px;
    position: absolute;
  }
  </style>
</head>
<body>
  <div class="demo-title">
    <h1>Color - Play</h1>
  </div>
   
  <div class="container-fluid col-md-12">
    <div class="row panel">
      <div class="col-md-8">
        <div class="demo-frame">
          <div class="demo-container">
              <video id="video" width="600" height="450" preload autoplay loop muted controls></video>
              <canvas id="canvas" width="600" height="450"></canvas>
          </div>
          <div class="row justify-content-center">
            <button type="button" class="btn btn-info" onclick="starttrack()">Start</button><br>
            <button type="button" class="btn btn-danger" onclick="stoptrack()">Stop</button>
          </div>
        </div>
        
      </div>
        <div class="col-md-4">
            <div id="datgui"></div>
        </div>
      </div>
    </div>
  
  <script>
    var trackTask;
    window.onload = function() {

      var video = document.getElementById('video');
      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');
      tracking.ColorTracker.registerColor('green', function(r, g, b) {
        if (r < 80 && g > 90 && b < 100) {
          return true;
        }
        return false;
      });
      tracking.ColorTracker.registerColor('red', function(r, g, b) {
        if (r > 200 && g < 100 && b < 60) {
          return true;
        }
        return false;
      });
      tracking.ColorTracker.registerColor('blue', function(r, g, b) {
        if (r < 50 && g < 140 && b > 100) {
          return true;
        }
        return false;
      });
      tracking.ColorTracker.registerColor('black', function(r, g, b) {
        if (r === g && g === b && b === r) {
          return true;
        }
        return false;
      });
      tracking.ColorTracker.registerColor('white', function(r, g, b) {
        if (r > 244 && g > 240 && b > 220) {
          return true;
        }
        return false;
      });
      var tracker = new tracking.ColorTracker(["green","blue"]);

      trackTask = tracking.track('#video', tracker, { camera: true });

      tracker.on('track', function(event) {
        context.clearRect(0, 0, canvas.width, canvas.height);

        event.data.forEach(function(rect) {

            context.strokeStyle = rect.color;
            context.strokeRect(rect.x, rect.y, rect.width, rect.height);
            context.font = '11px Helvetica';
            context.fillStyle = "#fff";
            context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
            context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);

          switch (rect.color) {
            case 'red':
                console.log("Color Red");
                checktrack('red');
                break;
            case 'yellow':
                console.log("Color yellow");
                checktrack('yellow');
                break;
            case 'blue':
                console.log("Color blue");
                checktrack('blue');
                break;
            case 'green':
                console.log("Color green");
                checktrack('green');
                break;
            case 'black':
                console.log("Color black");
                checktrack('black');
                break;
            case 'white':
                console.log("Color white");
                checktrack('white');
                break;
            case 'cyan':
                console.log("Color cyan");
                checktrack('cyan');
                break;
            case 'magenta':
                console.log("Color magenta");
                checktrack('magenta');
                break;
            default:
                console.log("Something went horribly wrong...");
                break;

            }
            
         });
      });
      
      initGUIControllers(tracker);
    };

    function starttrack(){
      trackTask.run();
    }

    function stoptrack(){
      trackTask.stop();
    }

    function checktrack(color){
       /*trackTask.stop();
        if(confirm("You found "+color+".... Want to play more ??"))
        {            
            trackTask.run();
        }
        else
        {
            camera:false;
        }*/

    }
  </script>

</body>
</html>
